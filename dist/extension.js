(()=>{"use strict";var e={137(e,t,n){var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),s=0;s<n.length;s++)"default"!==n[s]&&i(t,e,n[s]);return r(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{d(o.next(e))}catch(e){r(e)}}function a(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}d((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.XMindDocument=void 0;const d=s(n(398)),c=n(697);class l extends c.Disposable{static create(e,t,n){return a(this,void 0,void 0,function*(){const o="string"==typeof t?d.Uri.parse(t):e,i=yield l.readFile(o);return new l(e,i,n)})}static readFile(e){return a(this,void 0,void 0,function*(){return"untitled"===e.scheme?new Uint8Array:new Uint8Array(yield d.workspace.fs.readFile(e))})}constructor(e,t,n){super(),this._onDidDispose=this._register(new d.EventEmitter),this.onDidDispose=this._onDidDispose.event,this._onDidChangeDocument=this._register(new d.EventEmitter),this.onDidChangeContent=this._onDidChangeDocument.event,this._onDidChange=this._register(new d.EventEmitter),this.onDidChange=this._onDidChange.event,this._uri=e,this._documentData=t,this._delegate=n}get uri(){return this._uri}get documentData(){return this._documentData}dispose(){this._onDidDispose.fire(),super.dispose()}makeEdit(){this._onDidChange.fire({label:"Edit",undo:()=>a(this,void 0,void 0,function*(){yield this._delegate.undo()}),redo:()=>a(this,void 0,void 0,function*(){yield this._delegate.redo()})})}save(e){return a(this,void 0,void 0,function*(){yield this.saveAs(this.uri,e)})}saveAs(e,t){return a(this,void 0,void 0,function*(){const n=yield this._delegate.getFileData();t.isCancellationRequested||(yield d.workspace.fs.writeFile(e,n))})}revert(e){return a(this,void 0,void 0,function*(){const e=yield l.readFile(this.uri);this._documentData=e,this._onDidChangeDocument.fire({content:e})})}backup(e,t){return a(this,void 0,void 0,function*(){return yield this.saveAs(e,t),{id:e.toString(),delete:()=>a(this,void 0,void 0,function*(){try{yield d.workspace.fs.delete(e)}catch(e){}})}})}}t.XMindDocument=l},240(e,t,n){var o,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=o(e),s=0;s<n.length;s++)"default"!==n[s]&&i(t,e,n[s]);return r(t,e),t}),a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{d(o.next(e))}catch(e){r(e)}}function a(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}d((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.XMindEditorProvider=void 0;const d=s(n(398)),c=n(137),l=n(697),u=n(746);class p{static register(e){const t=new p(e),n=d.window.registerCustomEditorProvider(p.viewType,t,{webviewOptions:{retainContextWhenHidden:!0},supportsMultipleEditorsPerDocument:!1});return e.subscriptions.push(d.commands.registerCommand("xmind.exportPNG",e=>t.triggerExport("png",e)),d.commands.registerCommand("xmind.exportSVG",e=>t.triggerExport("svg",e)),d.commands.registerCommand("xmind.exportMarkdown",e=>t.triggerExport("md",e))),n}constructor(e){this.context=e,this.webviews=new h,this._onDidChangeCustomDocument=new d.EventEmitter,this.onDidChangeCustomDocument=this._onDidChangeCustomDocument.event,this._requestIdPool=0,this._callbacks=new Map}openCustomDocument(e,t,n){return a(this,void 0,void 0,function*(){const n=yield c.XMindDocument.create(e,t.backupId,{getFileData:()=>a(this,void 0,void 0,function*(){const e=Array.from(this.webviews.get(n.uri));if(!e.length)throw new Error("Could not find webview to save for");const t=e[0],o=yield this.postMessageWithResponse(t,"getFileData",{});return new Uint8Array(o)}),undo:()=>a(this,void 0,void 0,function*(){for(const e of this.webviews.get(n.uri))this.postMessage(e,"undo",{})}),redo:()=>a(this,void 0,void 0,function*(){for(const e of this.webviews.get(n.uri))this.postMessage(e,"redo",{})})}),o=[];return o.push(n.onDidChange(e=>{this._onDidChangeCustomDocument.fire(Object.assign({document:n},e))})),o.push(n.onDidChangeContent(e=>{var t;for(const o of this.webviews.get(n.uri))this.postMessage(o,"update",{data:Array.from(null!==(t=e.content)&&void 0!==t?t:new Uint8Array)})})),o.push(d.window.onDidChangeActiveColorTheme(t=>{for(const n of this.webviews.get(e))this.postMessage(n,"theme-change",{kind:t.kind})})),n.onDidDispose(()=>(0,l.disposeAll)(o)),n})}resolveCustomEditor(e,t,n){return a(this,void 0,void 0,function*(){this.webviews.add(e.uri,t),t.webview.options={enableScripts:!0},t.webview.onDidReceiveMessage(t=>this.onMessage(e,t)),t.webview.onDidReceiveMessage(n=>{if("ready"===n.type){const n=e.documentData;this.postMessage(t,"update",{data:Array.from(n)})}}),t.webview.html=this.getHtmlForWebview(t.webview)})}saveCustomDocument(e,t){return e.save(t)}saveCustomDocumentAs(e,t,n){return e.saveAs(t,n)}revertCustomDocument(e,t){return e.revert(t)}backupCustomDocument(e,t,n){return e.backup(t.destination,n)}postMessage(e,t,n){e.webview.postMessage({type:t,body:n})}triggerExport(e,t){let n;if(t&&t instanceof d.Uri){const e=Array.from(this.webviews.get(t));e.length>0&&(n=e.find(e=>e.active)||e.find(e=>e.visible)||e[0])}n||(n=this.webviews.activePanel),n?this.postMessage(n,"export",{type:e}):d.window.showErrorMessage("No active XMind editor found.")}postMessageWithResponse(e,t,n){const o=this._requestIdPool++,i=new Promise(e=>{this._callbacks.set(o,e)});return e.webview.postMessage({type:t,requestId:o,body:n}),i}onMessage(e,t){switch(t.type){case"edit":e.makeEdit();break;case"undo":case"redo":for(const n of this.webviews.get(e.uri))this.postMessage(n,t.type,{});break;case"response":const n=this._callbacks.get(t.requestId);return void(null==n||n(t.body));case"save-export":this.handleSaveExport(e,t.body);break;case"error":d.window.showErrorMessage(t.body)}}handleSaveExport(e,t){return a(this,void 0,void 0,function*(){let n;const o=d.workspace.getWorkspaceFolder(e.uri);n=o?d.Uri.joinPath(o.uri,t.filename):d.Uri.joinPath(e.uri,"..",t.filename);const i={defaultUri:n,filters:{}};"png"===t.type&&(i.filters.Images=["png"]),"svg"===t.type&&(i.filters.SVG=["svg"]),"md"===t.type&&(i.filters.Markdown=["md"]);const r=yield d.window.showSaveDialog(i);if(r){let e;if("png"===t.type){const n=t.content.split(",")[1];e=Buffer.from(n,"base64")}else e=Buffer.from(t.content,"utf8");yield d.workspace.fs.writeFile(r,e),d.window.showInformationMessage(`Successfully exported to ${r.fsPath}`)}})}getHtmlForWebview(e){const t=e.asWebviewUri(d.Uri.joinPath(this.context.extensionUri,"dist","webview.js")),n=(0,u.getNonce)();return`\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang="en">\n\t\t\t<head>\n\t\t\t\t<meta charset="UTF-8">\n\t\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t\t\t\t<title>XMind Viewer</title>\n                <style>\n                    html, body { \n                        margin: 0; \n                        padding: 0; \n                        width: 100%; \n                        height: 100%; \n                        overflow: hidden; \n                        background-color: #fff; \n                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n                        display: flex;\n                        flex-direction: column;\n                    }\n                    .vscode-dark, .vscode-dark body {\n                        background-color: #1e1e1e;\n                        color: #ccc;\n                    }\n                    #mindmap { \n                        flex: 1;\n                        width: 100%; \n                        height: 0;\n                        position: relative;\n                        background: #fff;\n                    }\n                    .vscode-dark #mindmap {\n                        background: #1e1e1e;\n                    }\n                    #tab-container {\n                        flex-shrink: 0;\n                        height: 34px; /* Slightly slimmer */\n                        background: #f8f8f8;\n                        border-top: 1px solid #ddd;\n                        display: flex;\n                        align-items: center;\n                        padding: 0 12px;\n                        overflow: hidden;\n                        z-index: 100;\n                        justify-content: space-between;\n                        box-shadow: 0 -2px 5px rgba(0,0,0,0.05);\n                    }\n                    #history-controls, #controls {\n                        display: flex;\n                        align-items: center;\n                        gap: 6px;\n                        flex-shrink: 0;\n                    }\n                    #history-controls button, #controls button {\n                        background: transparent;\n                        border: 1px solid transparent;\n                        border-radius: 4px;\n                        padding: 4px;\n                        cursor: pointer;\n                        font-size: 16px;\n                        line-height: 1;\n                        transition: all 0.2s;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        color: #666;\n                    }\n                    #history-controls button:hover, #controls button:hover {\n                        background: #eee;\n                        border-color: #ccc;\n                        color: #333;\n                    }\n                    #tabs-wrapper { \n                        flex-grow: 1;\n                        display: flex;\n                        align-items: center;\n                        height: 100%;\n                        overflow-x: auto;\n                        -webkit-overflow-scrolling: touch;\n                        margin: 0 15px;\n                    }\n                    #tabs-wrapper::-webkit-scrollbar { display: none; }\n                    .tab { \n                        padding: 4px 12px; \n                        margin-right: 4px; \n                        cursor: pointer; \n                        font-size: 11px; \n                        color: #666; \n                        background: #ececec;\n                        border: 1px solid #ddd;\n                        border-bottom: none;\n                        border-radius: 4px 4px 0 0;\n                        white-space: nowrap;\n                        transition: all 0.2s;\n                        align-self: flex-end;\n                        display: flex;\n                        align-items: center;\n                        gap: 8px;\n                        max-width: 140px; /* Limit width */\n                    }\n                    .tab span {\n                        overflow: hidden;\n                        text-overflow: ellipsis;\n                        white-space: nowrap;\n                    }\n                    .tab-close {\n                        font-size: 12px;\n                        color: #aaa;\n                        border-radius: 50%;\n                        width: 14px;\n                        height: 14px;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        line-height: 1;\n                        opacity: 0.6;\n                        transition: all 0.2s;\n                    }\n                    .tab-close:hover {\n                        background: #ff4d4f;\n                        color: #fff;\n                        opacity: 1;\n                    }\n                    .tab.active { \n                        background: #fff; \n                        color: #000; \n                        font-weight: 600;\n                        position: relative;\n                        top: 1px;\n                        border-bottom: 2px solid #fff;\n                        box-shadow: 0 -2px 4px rgba(0,0,0,0.03);\n                    }\n                    select {\n                        background: #fff;\n                        border: 1px solid #ddd;\n                        border-radius: 4px;\n                        font-size: 11px;\n                        padding: 2px 4px;\n                        outline: none;\n                        color: #666;\n                    }\n                    .export-dropdown {\n                        position: relative;\n                        display: inline-block;\n                    }\n                    .dropdown-content {\n                        display: none;\n                        position: absolute;\n                        right: 0;\n                        bottom: 40px;\n                        background-color: #f9f9f9;\n                        min-width: 130px;\n                        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);\n                        z-index: 1000;\n                        border-radius: 4px;\n                        overflow: hidden;\n                    }\n                    .vscode-dark .dropdown-content {\n                        background-color: #2d2d2d;\n                        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);\n                    }\n                    .dropdown-content a {\n                        color: #333;\n                        padding: 8px 12px;\n                        text-decoration: none;\n                        display: block;\n                        font-size: 12px;\n                    }\n                    .vscode-dark .dropdown-content a { color: #ccc; }\n                    .dropdown-content a:hover { background-color: #eee; }\n                    .vscode-dark .dropdown-content a:hover { background-color: #3e3e3e; }\n                    .export-dropdown.open .dropdown-content { display: block; }\n                    /* 暗色模式样式 - Sheet 栏 */\n                    .vscode-dark #tab-container {\n                        background: #252526;\n                        border-top-color: #3c3c3c;\n                        box-shadow: 0 -2px 5px rgba(0,0,0,0.2);\n                    }\n                    .vscode-dark #history-controls button, .vscode-dark #controls button {\n                        color: #ccc;\n                    }\n                    .vscode-dark #history-controls button:hover, .vscode-dark #controls button:hover {\n                        background: #3c3c3c;\n                        border-color: #555;\n                        color: #fff;\n                    }\n                    .vscode-dark .tab {\n                        background: #333 !important;\n                        color: #aaa !important;\n                        border-color: #444 !important;\n                    }\n                    .vscode-dark .tab.active {\n                        background: #1e1e1e !important;\n                        color: #e0e0e0 !important;\n                        border-bottom-color: #1e1e1e !important;\n                    }\n                    .vscode-dark .tab-close {\n                        color: #888;\n                    }\n                    .vscode-dark select {\n                        background: #3c3c3c;\n                        border-color: #555;\n                        color: #ccc;\n                    }\n\n                </style>\n\t\t\t</head>\n\t\t\t<body class="${d.window.activeColorTheme.kind===d.ColorThemeKind.Dark||d.window.activeColorTheme.kind===d.ColorThemeKind.HighContrast?"vscode-dark":"vscode-light"}">\n\t\t\t\t<div id="mindmap"></div>\n                <div id="tab-container"></div>\n\t\t\t\t<script nonce="${n}" src="${t}"><\/script>\n\t\t\t</body>\n\t\t\t</html>`}}t.XMindEditorProvider=p,p.viewType="vscode-xmind-viewer.xmindEditor";class h{constructor(){this._webviews=new Set}*get(e){const t=e.toString();for(const e of this._webviews)e.resource===t&&(yield e.webviewPanel)}add(e,t){const n={resource:e.toString(),webviewPanel:t};this._webviews.add(n),t.onDidDispose(()=>{this._webviews.delete(n)})}get activePanel(){const e=Array.from(this._webviews),t=e.find(e=>e.webviewPanel.active);if(t)return t.webviewPanel;const n=e.filter(e=>e.webviewPanel.visible);return 1===n.length?n[0].webviewPanel:1===e.length?e[0].webviewPanel:void 0}}},398(e){e.exports=require("vscode")},697(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Disposable=void 0,t.disposeAll=function(e){for(;e.length;){const t=e.pop();t&&t.dispose()}},t.Disposable=class{constructor(){this._disposables=[]}dispose(){for(;this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}_register(e){return this._disposables.push(e),e}}},746(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getNonce=function(){let e="";for(let t=0;t<32;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.activate=function(e){e.subscriptions.push(t.XMindEditorProvider.register(e))},e.deactivate=function(){};const t=n(240)})();var i=exports;for(var r in o)i[r]=o[r];o.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();